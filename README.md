# Exploration, Exploitation, and Engagement in Multi-Armed Bandits with Abandonment

This repository is the official implementation of [Exploration, Exploitation, and Engagement in Multi-Armed Bandits with Abandonment]. 


## Environment Requirements

- CUDA Toolkit v11.2.1
- CUDA Runtime 11.2
- Visual Studio 2019
- NVIDIA GPU with at least 6GB GPU Memory, CUDA supported
- MATLAB R2019b


## Organization of the Repository

- Files:
    - bandit_with_abandonment.sln:       open with Visual Studio, the main project
    - basic_function.cuh:                CUDA C++ codes: define basic data objects and basic thrust functors
    - constants.cuh:                     CUDA C++ codes: define the constants for the setting
    - main.cu:                           CUDA C++ codes: main() function
    - main_functions.cuh:                CUDA C++ codes: main regret calculation functions conducted in GPU

- Folders:
    - aband_prob_ub_lb_cont_state:       contains the calculation of the abandonment probabilities, the value functions, and the upper bound and lower bound for the continuous-state setting.
    - regret_data_1 - regret_data_6:     contain regret simulation results of different settings. See the TXT files inside the folders for details of simulation parameters.
    - vary_c0_and_c1:                    contains the simulation results for different c0 and c1 for ULCB


- Details of the simulation parameters in each folder:

    - regret_data_1: q(0,0) = 1.0, q(0,1) = q(1,0) = q(1,1) = 0, mu = [0.9, 0.8], c_6 = 1000

    - regret_data_2: q(0,0) = 0.8, q(0,1) = q(1,0) = 0.2, q(1,1) = 0.1, mu = [0.9, 0.8]

    - regret_data_3: q(0,0) = 1.0, q(0,1) = q(1,0) = q(1,1) = 0, mu = [0.2, 0.1]

    - regret_data_4: q(0,0) = 1.0, q(0,1) = q(1,0) = q(1,1) = 0, mu = [0.9, 0.8, 0.5]

    - regret_data_5: mu = [0.9, 0.8], c_6 = 100

    - regret_data_6: mu = [0.2, 0.1], c_6 = 1000


## Simulation

You need to recompile the codes to run the simulation. Please follow the steps:
- open "bandit_with_abandonment.sln" with Visual Studio
- build (compile) and run
- after the simulation completes, obtain simulation results in the folder "regret_data_temp"
- copy these results (txt files) to the corresponding folder ("regret_data_1", "regret_data_2",...,"regret_data_6", "vary_c0_and_c1/data") for plotting the figures.
- run the .m files starting with "plotfigs" with MATLAB one by one.

You may need to revise the values of the parameters in 'constants.cuh' and redo the aforementioned steps for different simulation settings.

### The variables in 'constants.cuh':

  Variable name and their meaning
 
- NUM_STATES: number of states used in the reinforcement learning algorithms, including Q-learning, UCB-VI, and SVI-SSP

- NUM_ARMS: number of arms

- Q_00: q(0,0)

- Q_01: q(0,1)

- Q_10: q(1,0)

- Q_11: q(1,1)

- K: The number of episodes run in one thrust functor

- NUM_KS: Number of K episodes; i.e. the total number of episodes = K*NUM_KS
			You may need to adjust K and NUM_KS to balance your GPU memory and the run time

- NUM_SIMS: Number of independent simulations, running in parallel in GPU

- MU[NUM_ARMS]: The mean reward values of the arms

- MAX_LEN_PER_EPISODE	Maximum length of one episode, truncated the episode length to avoid endless loop.
			This should be large enough so that the truncated error is small
			1e4 is enough, nearly no truncation occurs

- ALPHA: Forgetting factor for the continuous-state setting
  
- PARA_C: c_6 in the paper,
			a parameter in the abandonment probabilty function for the continuous-state setting

- BASELINE_CONT: Baseline value for the continuous-state setting, 
			It should be obtained by using 'calculate_V_log.m' in the folder 'aband_prob_ub_lb_cont_state'

- C_MIN: the parameter for the SVI-SSP algorithm in "Implicit Finite-Horizon Approximation and Efficient Optimal Algorithms for Stochastic Shortest Path"



## Resources and Run Time
GPU: NVIDIA GTX 1660Ti
CPU: Intel Core i5-9400 (2.90GHz, 9MB Cache)
RAM: 8GB DDR4 2666MHz
Run time: approximately 100 hours for producing all the simulation results (including those in the appendices)


## Results

See the figures in the paper or in the folders.
